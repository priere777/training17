<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚¸ã‚¿ãƒ«å‚æ‹æ‰‹å¸³</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-green: #2d5a27; --danger-red: #e74c3c; --bg-color: #f4f1e8; }
        body { margin: 0; padding: 20px; font-family: "Sawarabi Mincho", serif; background: var(--bg-color); color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #e0dccf; }
        
        /* ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ */
        .chart-container { width: 100%; margin-bottom: 30px; background: #fff; padding: 10px; border-radius: 10px; }
        h1 { text-align: center; color: var(--main-green); font-size: 1.4em; letter-spacing: 0.1em; }
        h2 { font-size: 1.1em; color: var(--main-green); border-bottom: 2px solid var(--main-green); padding-bottom: 5px; margin-top: 40px; }

        /* ã‚«ãƒ¼ãƒ‰å‹å±¥æ­´ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .history-list { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .history-item { 
            background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 15px;
            display: flex; justify-content: space-between; position: relative;
            transition: transform 0.2s;
        }
        .history-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        .shrine-info { display: flex; flex-direction: column; gap: 5px; }
        .shrine-name { font-weight: bold; font-size: 1.1em; color: #222; }
        .deity-name { font-size: 0.85em; color: #777; font-style: italic; }
        .visit-date { font-size: 0.8em; color: #aaa; }

        .right-area { display: flex; flex-direction: column; align-items: flex-end; justify-content: space-between; }
        .category-tag { 
            font-size: 0.7em; padding: 4px 10px; border-radius: 20px; 
            background: #eef5ee; color: var(--main-green); border: 1px solid var(--main-green);
        }

        /* å‰Šé™¤ãƒœã‚¿ãƒ³ */
        .btn-delete {
            background: none; border: none; color: #ddd; cursor: pointer; font-size: 1.3em;
            position: absolute; top: 10px; right: 10px; line-height: 1;
        }
        .btn-delete:hover { color: var(--danger-red); }

        /* å†™çœŸè¡¨ç¤ºï¼ˆå¾©æ´»ï¼ï¼‰ */
        .photo-container { margin-top: 10px; cursor: pointer; overflow: hidden; border-radius: 8px; width: 100px; height: 100px; }
        .card-photo { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .card-photo:hover { transform: scale(1.1); }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-link { 
            display:block; text-align:center; margin-top:30px; background: var(--main-green);
            color: white; text-decoration:none; font-weight:bold; padding: 15px; border-radius: 50px;
        }
        .backup-area { margin-top: 50px; padding: 20px; background: #fdfdfd; border: 1px dashed #ccc; border-radius: 10px; text-align: center; }
        .btn-backup { background: #999; color: white; border: none; padding: 8px 16px; border-radius: 5px; font-size: 0.8em; cursor: pointer; margin: 5px; }

        /* ã‚ºãƒ¼ãƒ ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå¾©æ´»ï¼ï¼‰ */
        #zoom-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center; }
        #zoom-img { max-width: 90%; max-height: 90%; border: 5px solid white; border-radius: 5px; }
    </style>
</head>
<body>
<div class="container">
    <h1>â›©ï¸ ãƒ‡ã‚¸ã‚¿ãƒ«å‚æ‹æ‰‹å¸³</h1>
    <div class="chart-container"><canvas id="statusChart"></canvas></div>

    <h2>ç¾åœ¨ã®å¾³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h2>
    <table style="width:100%; border-collapse: collapse; margin-top:10px;">
        <tbody id="status-body"></tbody>
    </table>

    <h2>å‚æ‹ã®ã‚ã‚†ã¿ï¼ˆå±¥æ­´ï¼‰</h2>
    <div id="history-list" class="history-list"></div>

    <a href="status.html" class="nav-link">ğŸ“ å‚æ‹ã‚’è¨˜éŒ²ã—ã«è¡Œã</a>

    <div class="backup-area">
        <p style="font-size:0.75em; color:#888;">ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</p>
        <button class="btn-backup" onclick="exportData()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
        <button class="btn-backup" onclick="document.getElementById('importFile').click()">ğŸ“‚ å¾©æ—§ã™ã‚‹</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
    </div>
</div>

<div id="zoom-modal" onclick="this.style.display='none'"><img id="zoom-img"></div>

<script>
    const catList = [
       { id: "fortune",      name: "é‡‘é‹ãƒ»ãƒ“ã‚¸ãƒã‚¹é‹", class: "cat-fortune" },      // 1: çœŸä¸Š
        { id: "stability",    name: "åœ°ç›¤ãƒ»å®‰å®šåŠ›", class: "cat-stability" },        // 2: å³ä¸Š
        { id: "purification", name: "æµ„åŒ–ãƒ»ãƒªã‚»ãƒƒãƒˆ", class: "cat-purification" },    // 3: å³ä¸‹
        { id: "creative",     name: "æ‰èƒ½ãƒ»ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–", class: "cat-creative" }, // 4: çœŸä¸‹ï¼ˆé‡‘é‹ã®å¯¾é¢ï¼‰
        { id: "breakthrough", name: "é–‹æ‹“ãƒ»çªç ´åŠ›", class: "cat-breakthrough" },    // 5: å·¦ä¸‹
        { id: "network",      name: "ã”ç¸ãƒ»ç¹‹ãŒã‚Š", class: "cat-network" }           // 6: å·¦ä¸Š
    ];

    let history = JSON.parse(localStorage.getItem('shrine_history') || '[]');

    function renderAll() {
        const stats = {};
        catList.forEach(c => stats[c.id] = 0);
        history.forEach(item => { if (stats.hasOwnProperty(item.category)) stats[item.category]++; });

        if (window.myChart) window.myChart.destroy();
        const ctx = document.getElementById('statusChart').getContext('2d');
        window.myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: catList.map(c => c.name),
                datasets: [{
                    data: catList.map(c => stats[c.id]),
                    backgroundColor: 'rgba(45, 90, 39, 0.2)', borderColor: 'rgba(45, 90, 39, 1)', borderWidth: 2
                }]
            },
            options: {
                scales: { r: { min: 0, suggestedMax: 5, ticks: { display: false } } },
                plugins: { legend: { display: false } }
            }
        });

        const tbody = document.getElementById('status-body');
        tbody.innerHTML = '';
        catList.forEach(c => {
            const row = document.createElement('tr');
            const stars = 'â˜…'.repeat(Math.min(stats[c.id], 5)) + 'â˜†'.repeat(Math.max(0, 5 - stats[c.id]));
            row.innerHTML = `<td style="padding:10px; border-bottom:1px solid #eee;"><b>${c.name}</b></td>
                             <td style="padding:10px; border-bottom:1px solid #eee; color:#f1c40f;">${stars}</td>`;
            tbody.appendChild(row);
        });

        const listDiv = document.getElementById('history-list');
        listDiv.innerHTML = '';
        [...history].reverse().forEach((item, index) => {
            const realIndex = history.length - 1 - index;
            const catName = catList.find(c => c.id === item.category)?.name || "";
            
            // å†™çœŸãŒã‚ã‚‹å ´åˆã®ã¿HTMLã‚’ä½œæˆ
            const photoHtml = item.photo ? `
                <div class="photo-container" onclick="zoomPhoto('${item.photo}')">
                    <img src="${item.photo}" class="card-photo">
                </div>` : '';

            const div = document.createElement('div');
            div.className = 'history-item';
            div.innerHTML = `
                <div class="shrine-info">
                    <div class="shrine-name">${item.name}</div>
                    <div class="deity-name">${item.deity ? 'ä¸»ç¥­ç¥: ' + item.deity : ''}</div>
                    <div class="visit-date">${item.date || 'æ—¥ä»˜æœªç™»éŒ²'}</div>
                    ${photoHtml}
                </div>
                <div class="right-area">
                    <button class="btn-delete" onclick="deleteHistory(${realIndex})">Ã—</button>
                    <div class="category-tag">${catName}</div>
                </div>
            `;
            listDiv.appendChild(div);
        });
    }

    window.zoomPhoto = function(src) {
        const modal = document.getElementById('zoom-modal');
        document.getElementById('zoom-img').src = src;
        modal.style.display = 'flex';
    };

    window.deleteHistory = function(index) {
        if(confirm("ã“ã®æ€ã„å‡ºã‚’å‰Šé™¤ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ")) {
            history.splice(index, 1);
            localStorage.setItem('shrine_history', JSON.stringify(history));
            renderAll();
        }
    };

    function exportData() {
        const blob = new Blob([localStorage.getItem('shrine_history')], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'my_shrine_diary.json';
        a.click();
    }
    function importData(event) {
        const reader = new FileReader();
        reader.onload = e => { 
            localStorage.setItem('shrine_history', e.target.result); 
            history = JSON.parse(e.target.result);
            renderAll(); 
        };
        reader.readAsText(event.target.files[0]);
    }
    renderAll();
</script>
</body>
</html>
