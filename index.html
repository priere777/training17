<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚æ‹è¨˜éŒ²ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-red: #8e1d1d; --gold: #d4af37; }
        body { margin: 0; padding: 20px; font-family: "Hiragino Mincho ProN", serif; background: #f4f1ea; color: #333; }
        .container { max-width: 550px; margin: 0 auto; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e0dcd0; }
        
        .chart-container { background: radial-gradient(circle, #fff 0%, #fafafa 100%); border-radius: 15px; padding: 10px; margin-bottom: 20px; }
        h2 { font-size: 1.1em; color: var(--main-red); border-bottom: 2px solid var(--main-red); padding-bottom: 5px; margin-top: 30px; }

        .history-item { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; gap: 15px; align-items: center; }
        .shrine-photo-thumb { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; border: 1px solid #ddd; cursor: pointer; background: #f9f9f9; display: flex; align-items: center; justify-content: center; font-size: 1.2em; }
        .shrine-info { flex-grow: 1; }
        .shrine-name { font-weight: bold; font-size: 1.1em; margin-bottom: 3px; }
        /* ğŸ’¡ ç¥æ§˜ã®åå‰ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .deity-info { font-size: 0.85em; color: #555; margin-bottom: 4px; }
        .visit-date { font-size: 0.8em; color: #888; }
        .category-tag { font-size: 0.7em; padding: 3px 8px; border-radius: 5px; color: white; margin-top: 5px; display: inline-block; }

        .cat-fortune { background: #f1c40f; } .cat-purification { background: #3498db; } .cat-stability { background: #27ae60; }
        .cat-network { background: #e91e63; } .cat-creative { background: #9b59b6; } .cat-breakthrough { background: #e67e22; }

        .btn-delete { color: #ccc; border: none; background: none; cursor: pointer; font-size: 1.2em; }
        .nav-link { display: block; text-align: center; margin-top: 25px; padding: 15px; background: var(--main-red); color: white; text-decoration: none; border-radius: 30px; font-weight: bold; box-shadow: 0 4px 10px rgba(142,29,29,0.3); }

        #photo-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center; }
        #photo-overlay img { max-width: 90%; max-height: 90%; border: 3px solid white; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; color:var(--main-red); letter-spacing: 0.2em;">ãƒ‡ã‚¸ã‚¿ãƒ«å‚æ‹æ‰‹å¸–</h1>
    <div class="chart-container"><canvas id="statusChart"></canvas></div>
    
    <h2>å‚æ‹ã®è¨˜éŒ²</h2>
    <div id="history-list"></div>
    
    <a href="status.html" class="nav-link">ğŸ“ å‚æ‹ã‚’è¨˜éŒ²ã—ã«ã„ã</a>

    <div style="margin-top: 40px; border-top: 1px dashed #ccc; padding-top: 20px;">
        <p style="font-size: 0.8em; color: #888; text-align: center; margin-bottom: 10px;">ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="exportData()" style="flex: 1; padding: 10px; font-size: 0.8em; background: #eee; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</button>
            <button onclick="document.getElementById('importFile').click()" style="flex: 1; padding: 10px; font-size: 0.8em; background: #eee; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;">ğŸ“‚ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©æ—§</button>
        </div>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
    </div>
</div>

<div id="photo-overlay" onclick="this.style.display='none'"><img id="full-photo"></div>

<script>
    const catList = [
        { id: "fortune",      name: "é‡‘é‹ãƒ»ãƒ“ã‚¸ãƒã‚¹é‹", class: "cat-fortune" },
        { id: "stability",    name: "åœ°ç›¤ãƒ»å®‰å®šåŠ›", class: "cat-stability" },
        { id: "purification", name: "æµ„åŒ–ãƒ»ãƒªã‚»ãƒƒãƒˆ", class: "cat-purification" },
        { id: "creative",     name: "æ‰èƒ½ãƒ»ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–", class: "cat-creative" },
        { id: "breakthrough", name: "é–‹æ‹“ãƒ»çªç ´åŠ›", class: "cat-breakthrough" },
        { id: "network",      name: "ã”ç¸ãƒ»ç¹‹ãŒã‚Š", class: "cat-network" }
    ];

    let history = JSON.parse(localStorage.getItem('shrine_history') || '[]');

    function renderAll() {
        const stats = {};
        catList.forEach(c => stats[c.id] = 0);
        history.forEach(item => { if (stats.hasOwnProperty(item.category)) stats[item.category]++; });

        if (window.myChart) window.myChart.destroy();
        const ctx = document.getElementById('statusChart').getContext('2d');
        window.myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: catList.map(c => c.name),
                datasets: [{
                    data: catList.map(c => stats[c.id]),
                    backgroundColor: 'rgba(142, 29, 29, 0.15)', borderColor: 'var(--main-red)', borderWidth: 2, pointBackgroundColor: 'var(--gold)'
                }]
            },
            options: { scales: { r: { min: 0, suggestedMax: 5, grid: { color: '#e0dcd0' } } }, plugins: { legend: { display: false } } }
        });

        const listDiv = document.getElementById('history-list');
        listDiv.innerHTML = '';
        [...history].reverse().forEach((item, index) => {
            const realIndex = history.length - 1 - index;
            const catInfo = catList.find(c => c.id === item.category);
            const div = document.createElement('div');
            div.className = 'history-item';
            
            // ğŸ’¡ å¾¡ç¥­ç¥ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°è¡¨ç¤ºã™ã‚‹
            const deityHtml = item.deity ? `<div class="deity-info">å¾¡ç¥­ç¥: ${item.deity}</div>` : '';
            const photoHtml = item.photo ? `<img src="${item.photo}" class="shrine-photo-thumb" onclick="zoomPhoto('${item.photo}')">` : `<div class="shrine-photo-thumb">â›©ï¸</div>`;
            
            div.innerHTML = `
                ${photoHtml}
                <div class="shrine-info">
                    <div class="shrine-name">${item.name}</div>
                    ${deityHtml}
                    <div class="visit-date">${item.date || ''}</div>
                    <div class="category-tag ${catInfo?.class}">${catInfo?.name}</div>
                </div>
                <button class="btn-delete" onclick="deleteHistory(${realIndex})">Ã—</button>
            `;
            listDiv.appendChild(div);
        });
    }

    window.zoomPhoto = function(src) { document.getElementById('full-photo').src = src; document.getElementById('photo-overlay').style.display = 'flex'; };
    window.deleteHistory = function(index) { if(confirm("ã“ã®æ€ã„å‡ºã‚’æ¶ˆã—ã¦ã‚‚ã„ã„ï¼Ÿ")) { history.splice(index, 1); localStorage.setItem('shrine_history', JSON.stringify(history)); renderAll(); } };
    window.exportData = function() {
        const data = localStorage.getItem('shrine_history');
        if (!data) return alert("ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“");
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'my_shrine_data.json'; a.click();
    };
    window.importData = function(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                localStorage.setItem('shrine_history', JSON.stringify(data));
                alert("ãƒ‡ãƒ¼ã‚¿ã‚’å¾©æ—§ã—ã¾ã—ãŸï¼"); location.reload();
            } catch (err) { alert("æ­£ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§ã­"); }
        };
        reader.readAsText(event.target.files[0]);
    };
    renderAll();
</script>
</body>
</html>
